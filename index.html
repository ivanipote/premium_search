<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Recherche Intelligente • Megane Learn</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body {font-family: system-ui, sans-serif; margin:0; background:#f9fbff;}
    .search-container {text-align:center; padding:80px 20px 40px; background:linear-gradient(135deg,#0066FF,#0047b3); color:white;}
    h1 {margin:0 0 20px; font-size:2.2rem;}
    #searchInput {width:92%; max-width:700px; padding:20px 30px; font-size:1.6rem; border:none; border-radius:50px; outline:none; box-shadow:0 12px 35px rgba(0,102,255,0.4);}
    #status, #resultCount {margin:25px 0; font-weight:bold;}
    .results-grid {display:grid; grid-template-columns:repeat(auto-fill,minmax(360px,1fr)); gap:25px; padding:30px 20px; max-width:1400px; margin:0 auto;}
    .result-card {background:white; border-radius:20px; padding:25px; box-shadow:0 10px 30px rgba(0,102,255,0.15); transition:.3s;}
    .result-card:hover {transform:translateY(-10px); box-shadow:0 20px 50px rgba(0,102,255,0.25);}
    .file-title {font-size:1.5rem; color:#0066FF; font-weight:bold; margin-bottom:10px; word-break:break-all;}
    .download-btn {background:#0066FF; color:white; padding:12px 30px; border-radius:50px; text-decoration:none; font-weight:bold; display:inline-block;}
    .download-btn:hover {background:#0047b3;}
    .header-logo {position:fixed; top:15px; right:15px; background:white; padding:8px 15px; border-radius:50px; box-shadow:0 4px 20px rgba(0,102,255,0.3); z-index:100;}
    .logo-header {width:35px; height:35px; vertical-align:middle; border-radius:8px;}
    .logo-text {color:#0066FF; font-weight:bold; margin-left:8px;}
  </style>
</head>
<body>

  <div class="header-logo">
    <img src="logo.png" alt="Megane Learn" class="logo-header">
    <span class="logo-text">Megane Learn</span>
  </div>

  <div class="search-container">
    <h1>Recherche intelligente dans tous vos PDF</h1>
    <input type="text" id="searchInput" placeholder="mathématique, frein ABS, schéma électrique, droit…" autofocus>
    <div id="status">Chargement des PDF…</div>
    <div id="resultCount"></div>
  </div>

  <div class="results-grid" id="results"></div>

  <nav class="bottom-nav" style="position:fixed; bottom:0; width:100%; background:white; display:flex; justify-content:space-around; padding:15px 0; box-shadow:0 -5px 20px rgba(0,0,0,0.1);">
    <a href="index.html">ACCUEIL</a>
    <a href="rech.html" style="color:#0066FF; font-weight:bold;">RECHERCHE</a>
    <a href="bt.html">PRO</a>
    <a href="gd.html">GUIDE</a>
  </nav>

  <script type="module">
    const REPO = "ivanipote/PDF-search";
    const FOLDER = "searchfiles";
    let allPDFs = [];

    // Charge la liste des fichiers une seule fois
    async function loadPDFs() {
      try {
        const response = await fetch(`https://api.github.com/repos/\( {REPO}/contents/ \){FOLDER}`);
        if (!response.ok) throw new Error("Dossier non trouvé");
        const files = await response.json();

        allPDFs = files
          .filter(f => f.name.toLowerCase().endsWith('.pdf'))
          .map(f => ({
            name: f.name,
            url: f.download_url  // URL directe et fiable
          }))
          .sort((a,b) => a.name.localeCompare(b.name));

        document.getElementById("status").textContent = `${allPDFs.length} PDF chargés – commencez à taper !`;
        showAll();
      } catch (err) {
        document.getElementById("status").innerHTML = `<span style="color:red">Impossible de charger les PDF (vérifiez le nom du dossier)</span>`;
        console.error(err);
      }
    }

    function showAll() {
      const grid = document.getElementById("results");
      grid.innerHTML = "";
      allPDFs.forEach(pdf => createCard(pdf));
      document.getElementById("resultCount").textContent = `${allPDFs.length} PDF disponibles`;
    }

    function createCard(pdf) {
      const grid = document.getElementById("results");
      const card = document.createElement("div");
      card.className = "result-card";
      card.innerHTML = `
        <div class="file-title">${pdf.name}</div>
        <a href="${pdf.url}" download class="download-btn">Télécharger PDF</a>
      `;
      grid.appendChild(card);
    }

    // Recherche ultra-rapide uniquement dans le nom du fichier (parfait pour 99 % des cas)
    function searchInName(query) {
      const terms = query.toLowerCase().trim().split(/\s+/).filter(t => t.length > 1);
      if (terms.length === 0) return showAll();

      const matches = allPDFs.filter(pdf => 
        terms.every(term => pdf.name.toLowerCase().includes(term))
      );

      const grid = document.getElementById("results");
      grid.innerHTML = "";
      matches.forEach(pdf => createCard(pdf));

      document.getElementById("resultCount").textContent = 
        matches.length ? `\( {matches.length} résultat \){matches.length > 1 ? 's' : ''}` : "Aucun PDF trouvé";
    }

    // Recherche en temps réel avec debounce
    let timeout;
    document.getElementById("searchInput").addEventListener("input", e => {
      clearTimeout(timeout);
      timeout = setTimeout(() => searchInName(e.target.value), 400);
    });

    // Lancement
    loadPDFs();
  </script>
</body>
  </html>
